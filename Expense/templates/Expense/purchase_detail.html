{% extends "main.html" %}
{% load humanize %}

{% block content %}

<div class="container-fluid py-3 py-lg-4">

  <!-- HEADER BAR -->
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
    <div class="mb-2 mb-lg-0">
      <h4 class="fw-semibold mb-1 d-flex align-items-center gap-2">
        <i class="bi bi-receipt-cutoff text-primary"></i>
        Purchase #{{ purchase.id }}
      </h4>
      <small class="text-muted d-block">
        {{ purchase.created_at|date:"F d, Y · h:i A" }}
      </small>
      <small class="text-muted">
        Supplier: {{ purchase.supplier_name|default:"Walk-in supplier" }}
      </small>
    </div>
    <div class="d-flex flex-column align-items-end gap-1 small text-muted">
      <span class="badge bg-light text-dark border">
        {{ purchase_items|length }} line{{ purchase_items|length|pluralize }}
      </span>
      <span>
        Total cost:
        <span class="fw-semibold text-success">
          ₱{{ purchase.total_cost|floatformat:2 }}
        </span>
      </span>
    </div>
  </div>

  <div class="row g-3 g-lg-4">

    <!-- LEFT: LINE ITEMS -->
    <div class="col-lg-8 col-xl-9">
      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
          <div class="d-flex align-items-center gap-2">
            <i class="bi bi-basket3 text-primary"></i>
            <h6 class="mb-0 fw-semibold">Purchased Items</h6>
          </div>
          <small class="text-muted d-none d-sm-inline">
            Materials, quantities, and cost per line.
          </small>
        </div>

        <div class="table-responsive">
          <table class="table table-sm mb-0 align-middle table-hover">
            <thead class="table-light small text-uppercase">
              <tr>
                <th class="ps-3 ps-lg-4">Item</th>
                <th class="text-center">Qty</th>
                <th class="text-end">Unit cost</th>
                <th class="text-end">Discount</th>
                <th class="text-end pe-3 pe-lg-4">Line total</th>
              </tr>
            </thead>
            <tbody>
              {% for line in purchase_items %}
              <tr>
                <td class="ps-3 ps-lg-4">
                  <div class="fw-semibold">
                    {{ line.material.name|default:line.material }}
                  </div>
                  {% if line.material.code %}
                  <div class="small text-muted">
                    Code: {{ line.material.code }}
                  </div>
                  {% endif %}
                </td>
                <td class="text-center">
                  {{ line.quantity|intcomma }}
                </td>
                <td class="text-end">
                  ₱{{ line.material.price|floatformat:2 }}
                </td>
                <td class="text-end">
                  ₱{{ line.discount|default:0|floatformat:2 }}
                </td>
                <td class="text-end pe-3 pe-lg-4 fw-semibold text-success">
                  ₱{{ line.total_price_per_item|floatformat:2 }}
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center py-4 text-muted">
                  No items on this purchase.
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </div>
    </div>

    <!-- RIGHT: SUMMARY / ACTIONS -->
    <div class="col-lg-4 col-xl-3">
      <div class="card border-0 shadow-sm rounded-4 mb-3">
        <div class="card-header bg-dark text-white px-3 px-lg-4 py-2 d-flex justify-content-between align-items-center">
          <div class="d-flex align-items-center gap-2">
            <i class="bi bi-calculator"></i>
            <h6 class="mb-0 fw-semibold">Totals</h6>
          </div>
        </div>
        <div class="card-body px-3 px-lg-4 py-3 small d-flex flex-column gap-2">
          <div class="d-flex justify-content-between">
            <span class="text-muted">Subtotal</span>
            <span class="fw-semibold">
              ₱{{ purchase.total_cost_per_purchase|floatformat:2 }}
            </span>
          </div>
          <div class="d-flex justify-content-between">
            <span class="text-muted">Total Discount</span>
            <span class="fw-semibold text-danger">
              ₱{{ purchase.total_discount|default:0|floatformat:2 }}
            </span>
          </div>
          <hr class="my-2">
          <div class="d-flex justify-content-between align-items-center">
            <span class="fw-semibold">
              Total Cost
            </span>
            <span class="fs-4 fw-bold text-success">
              ₱{{ purchase.total_cost|floatformat:2 }}
            </span>
          </div>
        </div>
      </div>

      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body small d-flex flex-column gap-2">
          <div class="fw-semibold mb-1">Actions</div>
          <div class="d-grid gap-2">
            <a href="#" class="btn btn-sm btn-outline-secondary">
              <i class="bi bi-printer me-1"></i>
              Print receipt
            </a>
            <a href="{% url 'purchase-list' %}" class="btn btn-sm btn-primary">
              <i class="bi bi-arrow-left-circle me-1"></i>
              Back to history
            </a>
          </div>
        </div>
      </div>

    </div>

  </div>
</div>

{% endblock content %}
