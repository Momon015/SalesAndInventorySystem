{% extends 'main.html' %}
{% block content %}

<div class="container-fluid py-3 py-lg-4">

  <!-- HEADER -->
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
    <div class="mb-2 mb-lg-0">
      <h4 class="fw-bold mb-1 d-flex align-items-center gap-2 text-success">
        <i class="bi bi-check-circle"></i>
        Purchase Summary
      </h4>
      <small class="text-muted">
        Review this purchase material before posting it to inventory.
      </small>
    </div>
    <div class="text-muted small">
      <span class="badge bg-light text-dark border">
        {{ cart_items|length }} line{{ cart_items|length|pluralize }}
      </span>
    </div>
  </div>

  <div class="row g-3 g-lg-4">

    <!-- LEFT: ITEMS RECEIPT -->
    <div class="col-lg-8">
      <!-- removed h-100 so card only grows with content -->
      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-header bg-light d-flex align-items-center justify-content-between">
          <div class="d-flex align-items-center gap-2">
            <i class="bi bi-basket3 text-primary"></i>
            <h6 class="mb-0 fw-semibold">Purchased items</h6>
          </div>
          <small class="text-muted d-none d-sm-inline">
            Materials, quantities, and cost per line.
          </small>
        </div>

        <!-- table will expand with rows, then scroll past max height -->
        <div class="table-responsive" style="max-height: 420px; overflow-y: auto;">
          <table class="table table-sm table-hover mb-0 align-middle">
            <thead class="table-light small text-uppercase">
              <tr>
                <th>Item</th>
                <th class="text-center">Qty</th>
                <th class="text-end">Unit cost</th>
                <th class="text-end">Discount</th>
                <th class="text-end">Line total</th>
              </tr>
            </thead>
            <tbody>
              {% for item in cart_items %}
              <tr>
                <td>
                  <div class="fw-semibold">{{ item.name }}</div>
                </td>
                <td class="text-center">{{ item.quantity }}</td>
                <td class="text-end">₱{{ item.price|floatformat:2 }}</td>
                <td class="text-end">₱{{ item.discount|floatformat:2 }}</td>
                <td class="text-end fw-semibold text-success">
                  ₱{{ item.item_discount|floatformat:2 }}
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center py-4 text-muted">
                  No items on this purchase yet.
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </div>
    </div>

    <!-- RIGHT: TOTALS & ACTIONS -->
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm rounded-4 mb-3">
        <div class="card-header bg-dark text-white">
          <div class="d-flex align-items-center gap-2">
            <i class="bi bi-calculator"></i>
            <h6 class="mb-0 fw-semibold">Purchase totals</h6>
          </div>
        </div>
        <div class="card-body small d-flex flex-column gap-2">
          <div class="d-flex justify-content-between align-items-center">
            <div class="text-muted">
              <i class="bi bi-calculator me-1 text-primary"></i>
              Subtotal
            </div>
            <div class="fw-semibold">₱{{ subtotal|floatformat:2 }}</div>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <div class="text-muted">
              <i class="bi bi-percent me-1 text-success"></i>
              Total Discount
            </div>
            <div class="fw-semibold text-danger">₱{{ total_discount|floatformat:2 }}</div>
          </div>
          <hr class="my-2">
          <div class="d-flex justify-content-between align-items-center">
            <div class="fw-semibold">
              <i class="bi bi-cash-stack me-1 text-danger"></i>
              Total Cost
            </div>
            <div class="fs-4 fw-bold text-success">
              ₱{{ total_after_discount|floatformat:2 }}
            </div>
          </div>
        </div>
      </div>

      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body">
          <div class="small text-muted mb-2">
            Confirm this purchase to update inventory cost and stock.
          </div>
          <div class="d-grid gap-2">
            <a href="{% url 'view-cart' %}" class="btn btn-outline-secondary btn-sm">
              <i class="bi bi-pencil-square me-1"></i>
              Edit items
            </a>
            <a href="{% url 'purchase-summary' %}" class="btn btn-success btn-lg">
              <i class="bi bi-check2-circle me-1"></i>
              Confirm Purchase
            </a>
          </div>
        </div>
      </div>

    </div>

  </div>
</div>

{% endblock content %}
