{% extends "main.html" %}

{% load tz %}
{% block content %}

<div class="container py-5">

  <!-- PAGE HEADER -->
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3">
    <div>
      <h2 class="fw-semibold mb-1 d-flex align-items-center gap-2">
        <i class="bi bi-person-circle text-primary"></i>


        User Profile
      </h2>
      <p class="text-muted small">Manage your account details and security settings</p>
    </div>
    <div class="d-flex gap-2">
      <a href="{% url 'user-edit-profile' user.slug %}" 
         class="btn btn-primary btn-sm d-flex align-items-center gap-1">
        <i class="bi bi-pencil-square"></i> Edit Profile
      </a>
      <form method="post" action="{% url 'user-delete' user.slug %}">
        {% csrf_token %}
        <button type="submit" 
                class="btn btn-danger btn-sm d-flex align-items-center gap-1"
                onclick="return confirm('Are you sure you want to delete this account?');">
          <i class="bi bi-trash"></i> Delete
        </button>
      </form>
    </div>
  </div>

  <div class="row g-4">

    <!-- LEFT: PROFILE SUMMARY -->
    <div class="col-lg-4">
      <div class="card shadow-sm rounded-4 p-4 text-center">

        <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mx-auto mb-3"
             style="width:80px; height:80px; font-size:1.8rem;">
          {{ user.name|default:user.username|first|upper }}
        </div>

        <h5 class="mb-1">{{ user.name|default:user.username }}</h5>
        <p class="text-muted small mb-2">{{ user.email|default:"No email" }}</p>

        <span class="badge bg-secondary mb-3">{{ user.get_role_display }}</span>

        <div class="border-top pt-3 mt-3 text-start small">
          <div class="d-flex justify-content-between mb-1">
            <span class="text-muted">Joined</span>
            <span>{{ user.date_joined|date:"M d, Y" }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span class="text-muted">Status</span>
            <span class="text-success fw-medium">Active</span>
          </div>
        </div>

      </div>
    </div>

    <!-- RIGHT: DETAILS -->
    <div class="col-lg-8">
      <div class="card shadow-sm rounded-4 p-4 mb-4">

        <h6 class="fw-semibold mb-3">
          <i class="bi bi-person-lines-fill me-1"></i> Personal Information
        </h6>

        <div class="row g-3 small text-muted">
          <div class="col-md-6">
            <div>Full Name</div>
            <div class="fw-medium text-dark">{{ user.full_name|default:"—" }}</div>
          </div>
          <div class="col-md-6">
            <div>Email</div>
            <div class="fw-medium text-dark">{{ user.email|default:"—" }}</div>
          </div>
          <div class="col-md-6">
            <div>Phone</div>
            <div class="fw-medium text-dark">{{ user.phone_number|default:"—" }}</div>
          </div>
          <div class="col-md-6">
            <div>Birthday</div>
            <div class="fw-medium text-dark">
              {% if user.birthday %}
                {{ user.birthday|date:"M d, Y" }}
              {% else %}
                —
              {% endif %}
            </div>
          </div>
        </div>

        <hr class="my-4">

        <div class="d-flex justify-content-between align-items-center small text-muted">
          <span>Account permissions are managed by administrators.</span>
          <span class="badge bg-light text-dark">Role: {{ user.get_role_display }}</span>
        </div>

      </div>

      <!-- OPTIONAL: Security / Login Info -->
      <div class="card shadow-sm rounded-4 p-4">
        <h6 class="fw-semibold mb-3">
          <i class="bi bi-shield-lock me-1"></i> Security & Activity
        </h6>
        <ul class="list-group list-group-flush small">
          <li class="list-group-item d-flex justify-content-between align-items-center">
            Last Login
            <span class="text-dark">
              {% if user.last_login %}
                {{ user.last_login|localtime|date:"M d, Y h:i A" }}
              {% else %}
                Never
              {% endif %}
            </span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            Password Last Changed
            <span class="text-dark">
              {% if user.password_changed_at %}
                {{ user.password_changed_at|date:"M d, Y" }}
              {% else %}
                Not Yet
              {% endif %}
            </span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            Two-Factor Authentication
            <span class="text-dark">
              {% if user.two_factor_enabled %}
                Enabled
              {% else %}
                Disabled
              {% endif %}
            </span>
          </li>
        </ul>
      </div>

    </div>

  </div>

</div>

{% endblock %}
